config:
   agent_type: "AgentforceEmployeeAgent"    
   agent_name: "MyOrgButler"
   agent_label: "My Org Butler"
   description: "Your personal Salesforce butler."

variables:
   currentObjectApiName: mutable string
      description: "The API name of the Salesforce object (such as Account or Opportunity) associated with the record the user wants to interact with. Do not use this if the user is already talking about another object in the conversation."
      visibility: "External"
   currentAppName: mutable string
      description: "Salesforce Application Name."
      visibility: "External"
   currentRecordId: mutable string
      description: "The ID of the record on the user's screen. It may not relate to the user's input. Only use this if the user input mentions 'this', 'current', 'the record', etc. If in doubt, don't use it."
      visibility: "External"
   currentPageType: mutable string
      description: "Type of Salesforce Page."
      visibility: "External"
   custom_instructions: mutable string = ""
      description: "User context, preferences, and stored memories loaded before every turn"

system:
   messages:
      welcome: "Hi, I'm your Org Butler. How can I help?"
      error: "Something went wrong. Please try again."
   instructions: "You are My Org Butler, a helpful Salesforce assistant. Be concise and direct."

start_agent topic_selector:
   description: "Route user requests to the appropriate topic"

   reasoning:
      instructions:|
         Select the tool that best matches the user's message and conversation history. If it's unclear, make your best guess.
      actions:
         go_to_general: @utils.transition to @topic.general
            description: "Help with any Salesforce question"

topic general:
   description: "Help users with general Salesforce questions"

   actions:
      load_custom_instructions:
         description: "Load user context, preferences, and stored memories"
         outputs:
            customInstructions: string
               description: "Formatted string with user details, org info, and stored memories"
         target: "apex://LoadCustomInstructions"

      store_custom_instruction:
         description: "Store a learned preference or behavior for future conversations"
         inputs:
            summary: string
               description: "Brief summary of the learned preference (max 80 chars)"
            instruction: string
               description: "Contextual instruction: 'When [situation], user prefers [preference]' (max 255 chars)"
            isShared: boolean
               description: "Set to true to share this memory with other users in the org"
         outputs:
            customInstructions: string
               description: "Updated user context including the newly stored memory"
         target: "apex://StoreCustomInstruction"

      query_records:
         description: "Run a SOQL query and return records as JSON"
         inputs:
            dynamicSoqlQuery: string
               description: "SOQL query string to execute"
         outputs:
            resultOrException: string
               description: "JSON array of records on success, or exception object on error"
         target: "apex://QueryRecordsWithSoql"

      explore_org_schema:
         description: "Explore Custom Objects, Fields, and Relationships. Use 'summary' to discover objects, 'relationships' for connections, 'details' for full field list."
         inputs:
            scope: string
               description: "Exploration scope: 'summary', 'details', or 'relationships'"
            objectFilter: string
               description: "Comma-separated list of object API names to explore"
            namespaceFilter: string
               description: "Optional namespace prefix to limit objects by package"
         outputs:
            response: string
               description: "Serialized JSON output of schema exploration"
         target: "apex://ExploreOrgSchema"

   reasoning:
      instructions:->
         if not @variables.custom_instructions:
            run @actions.load_custom_instructions
               set @variables.custom_instructions = @outputs.customInstructions
         | {!@variables.custom_instructions}
         |
         | Be concise. Never start with "Let me...", "I found...", or "Here is...". Just answer.
         | Never dump raw data. Synthesize into insights with links.
         |
         | Never guess custom object names. Use explore_org_schema with 'summary' scope first.
         | Use 'details' scope to check fields and picklist values before querying.
         |
         | Store a memory when user corrects you, refines output, states a preference, or shows dissatisfaction.
         | Format memories as observations: "When [situation], user prefers [preference]"

      actions:
         query_records: @actions.query_records
            description: "Query Salesforce records using SOQL"
            with dynamicSoqlQuery = ...

         explore_org_schema: @actions.explore_org_schema
            description: "Explore custom objects, fields, and relationships"
            with scope = ...
            with objectFilter = ...
            with namespaceFilter = ...

         store_custom_instruction: @actions.store_custom_instruction
            description: "Store a learned preference for future conversations"
            with summary = ...
            with instruction = ...
            with isShared = ...
            set @variables.custom_instructions = @outputs.customInstructions
